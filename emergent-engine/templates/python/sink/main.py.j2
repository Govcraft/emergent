#!/usr/bin/env python3
"""{{ name_pascal }} Sink

{{ description }}

Subscribes:
{% for sub in subscribes %}
- {{ sub }}
{% endfor %}
"""

import asyncio
import os

from emergent import EmergentSink
from emergent._protocol import Format


async def main() -> None:
    """Run the {{ name }} sink."""
    name = os.environ.get("EMERGENT_NAME", "{{ name }}")
    subscribes = [{% for sub in subscribes %}"{{ sub }}"{% if not loop.last %}, {% endif %}{% endfor %}]

    async for msg in EmergentSink.messages(name, subscribes, format_=Format.MSGPACK):
        # TODO: Process the incoming message
        print(f"[{msg.message_type}] {msg.payload}")


if __name__ == "__main__":
    asyncio.run(main())
